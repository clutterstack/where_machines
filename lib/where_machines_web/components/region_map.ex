defmodule WhereMachinesWeb.RegionMap do
  use Phoenix.Component
  require Logger


  import WhereMachines.CityData

  @bbox {0, 0, 800, 391}
  @minx 0
  @miny 10
  @w 800
  @h 320

  attr :minx, :integer, default: @minx
  attr :miny, :integer, default: @miny
  attr :maxx, :integer, default: @minx + @w
  attr :maxy, :integer, default: @miny + @h
  attr :viewbox, :string, default: "#{@minx} #{@miny} #{@w} #{@h}"
  attr :toppath, :string, default: "M #{@minx + 1} #{@miny + 0.5} H #{@w - 0.5}"
  attr :btmpath, :string, default: "M #{@minx + 1} #{@miny + @h - 1} H #{@w - 0.5}"

  # Render the world map SVG
  def world_map_svg(assigns) do
    # "0 0 800 391"
    ~H"""
    <svg viewBox={@viewbox} stroke-linecap="round" stroke-linejoin="round"  xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="goldGlow" x="-30%" y="-30%" width="160%" height="160%">
          <feGaussianBlur stdDeviation="4" result="blur"/>
          <feFlood flood-color="#EAD588" flood-opacity="0.7" result="glowColor"/>
          <feComposite in="glowColor" in2="blur" operator="in" result="softGlow"/>
          <feComposite in="softGlow" in2="SourceGraphic" operator="over"/>
        </filter>
        <!-- Gradient for metallic effect -->
        <linearGradient id="platinumFill" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#E5E4E240"/>
            <stop offset="50%" stop-color="#A9A8A780"/>
            <stop offset="100%" stop-color="#33333380"/>
        </linearGradient>
      </defs>
      <g id="ne_110m_ocean">
        <path d="M 508.86 108.99 503.48 101.62 513.48 96.21 517.58 96.64 517.57 100.18 511.51 101.61 513.81 104.89 521.33 109.73 517.3 109.89 519.31 118.56 512.7 118.77 509.06 117.19 508.86 108.99 Z"
          stroke="#DAA520"
          stroke-width="1"
          fill="#444444"
          fill-rule="evenodd"
        />
        <path d="M 799 41.97 799 43.49 799 47.63 777.84 45.12 756.75 46.58 752.45 43.41 739.08 43.47 731.39 40.46 711.37 39.02 710.04 42.04 691.02 43.59 685.04 38.6 673.09 38.75 642.5 36.07 652.45 33.52 632.1 29.53 614.3 32.22 593.22 33.99 592.46 36.61 578.47 37.25 576.56 40.19 562.04 42.13 563.3 48.86 555.03 38.59 547.84 43.05 551.87 49.56 534.22 45.67 530.34 47.81 519.07 47.87 502.74 52.72 498.71 52.52 477.46 57.71 475.19 52.52 485.08 54.2 489.32 49.92 466.51 44.92 462.43 42.71 442.52 45.74 423.34 57.56 411.07 63.13 412.56 70.63 418.58 71.24 422.96 68.68 428.69 77.78 435.2 76.14 437.3 70.34 441.65 67.32 437.95 64.53 449.17 54.81 456.3 56.17 446.68 61.72 450.69 67.84 462.22 66.38 462.02 68.66 451.74 69.3 447.15 78.16 431.3 81.34 424.25 80.78 421.39 77.54 423.45 72.53 418.94 73.91 419.51 80.75 410.43 82.81 408.49 86.07 396.42 92.67 389.82 92.58 397.35 98.5 395.79 104.25 382.32 103.52 379.18 105.12 380.56 110.15 378.88 114.63 380.27 118.77 385.55 118.61 388.08 120.82 395.24 119.21 398.49 117.06 401.8 109.58 406.74 107.64 406.87 105.02 414.47 104.9 419.7 102.15 428.57 109.06 434.17 111.73 435.69 116.3 440.74 111.04 435.22 108.42 427.91 102.76 429.13 99.12 435.5 104.06 443.31 108.02 443.02 111.28 448.04 118.83 453.26 115.78 450.57 110.78 463.85 109.5 461.34 106.12 468.16 97.24 474.45 98.86 475.11 102.17 480.98 99.71 479.41 97.1 486.72 95.73 481.3 100.21 491.89 105.97 492.11 108.43 485 109.73 477.96 107.31 469.04 109.42 464.82 109.13 458.01 113.02 461.27 119.24 472.06 120.46 476.95 118.94 480.13 121.1 475.96 131.3 466.71 130.73 464.09 132.07 446.23 128 442.31 133.41 434.83 130.95 433.79 128.98 424.62 126.7 422.5 124.4 423.5 119.79 421.08 117.71 403.25 119.36 395.19 122.54 386.86 121.23 384.68 124.89 380.81 126.82 378.8 134.15 367.99 142.3 362.18 153.95 363.92 155.96 363.51 164.73 360.93 167.85 363.17 173.52 367.11 176.39 371.3 183.21 380.04 189.79 383.33 190.88 391.11 189.02 395.64 190.06 402.35 187.36 409.59 186.6 413.07 191.05 418.84 189.92 421.71 193.69 419.5 202.96 426.41 211.67 429.34 219.48 430.22 227.19 426.99 232.53 426.15 240.55 431.6 249.51 433.72 260.55 440.39 270.68 440.44 275.57 443.48 277.68 450.04 275.57 457.15 275.74 462.55 273.14 471.96 263.23 473.18 256.71 477.67 254.76 478.83 249.47 477.11 244.35 482.93 239.48 487.45 237.56 490.39 233.07 489.73 224.36 486.01 214.85 489.25 206.2 495.62 199.85 503.22 194.17 509.62 185.42 513.15 176.91 513.3 173.85 497.79 177.35 496.02 173.04 487.04 165.2 483.08 159.24 481.72 151.73 472.56 136.87 477.87 138.29 486.6 150.45 486.76 153.3 494.54 163.32 496.39 172.49 507.91 169.46 515.64 165.93 516.12 164.19 524.76 160.87 528.1 158.23 532.57 151.05 525.01 145.25 524.94 141.99 519.72 147.03 514.81 147.26 508.19 139.12 506.34 134.05 511.09 133.67 514.2 138.73 521.29 141.8 525.22 140.33 527.23 143.44 536.32 144.91 547.13 144.14 554.38 150.73 556.21 154.22 561 153.16 563 165.05 569.78 180.77 571.88 182.84 577.02 177.54 578.05 165.26 591.74 155.83 592.8 152.85 600.1 152.1 602.64 150.04 609.09 160.13 608.79 164.95 611.4 165.67 615.38 162.97 618.93 175.14 617.57 181.99 620.6 184.22 624.75 194.38 629.47 197.78 629.16 189.74 622.68 184.03 619.79 178.42 621.88 170.78 627.4 173.49 629.42 176.93 632.92 178.51 633.1 181.44 642.06 174.64 641.34 166.64 634.22 158.25 636.55 154.62 640.56 152.36 645.57 153.07 656.89 150 663.02 146.09 670.64 134.37 670.23 130.25 664.12 123.12 668.45 119.26 660.53 114.63 669.64 109.74 668.34 114.28 675.46 111.99 676.45 116.03 679.69 116.82 680.38 124.27 686.15 122.73 686.97 118.96 682.7 112.37 693.22 104.55 698.96 104.3 706.39 97.85 710.47 93.11 713.32 82.82 699.53 79.18 715.21 69.63 735.31 70.2 747.4 64.32 754.94 66.29 764.58 61.85 762.8 64.97 751.04 71.81 747.6 72.31 744.54 77.74 747.55 87.43 755.48 80.04 759.36 78.9 762.51 67.79 774.4 66.23 777.57 67.76 784.99 63.84 797.6 60.89 793.26 57.29 799 56.46 799 63.34 799 75.81 799 88.28 799 100.75 799 113.22 799 125.69 799 138.16 799 150.63 799 163.09 799 175.56 799 188.03 799 200.5 799 212.97 799 225.44 799 236.12 799 237.2 799 237.91 799 250.38 799 262.84 799 275.31 799 287.78 799 300.25 799 312.72 799 325.19 799 337.66 799 350.13 799 362.59 799 375.06 799 387.53 799 388.28 754.2 379.93 770.17 375.06 762.4 371.33 768.18 365.38 779.51 359.43 760.62 357.3 742 352.48 738.05 353.17 722.5 348.83 704.7 348.92 698.71 347.27 671.14 348.05 667.93 349.44 651.82 346.53 635.37 348.87 627.95 345.83 621.04 349.57 596.9 348.92 583.49 349.48 572.11 354.48 563.73 355.39 557.44 360.3 550.62 359.77 552.71 351.09 538.29 351.26 524.92 346.74 516.63 346.92 488.71 353.69 485.67 355.17 475.08 352.35 472.6 354.3 450.03 357.21 442.69 355.43 421.11 355.69 383.56 359.43 377.18 358.47 365.76 362.64 352.95 368.77 335.98 370.46 320.69 374.15 336.71 378.58 289.7 381.67 270.94 384.97 259.78 381.71 232.95 378.41 228.78 370.55 243.5 370.37 262.65 365.51 263.65 358.08 254.79 350.31 262.3 347.22 260.35 343.79 249.84 349.74 247.19 362.34 231.04 364.47 203.99 362.34 186.45 363.68 170.17 361.47 176.9 367.42 161.58 367.16 147.42 363.9 134.66 365.6 100.27 365.2 80.09 367.94 64.54 372.07 52.04 371.85 55.69 375.76 74.66 377.67 61.16 382.36 70.75 390.27 23.27 386.44 1 388.28 1 387.53 1 375.06 1 362.59 1 350.13 1 337.66 1 325.19 1 312.72 1 300.25 1 287.78 1 275.31 1 262.84 1 250.38 1 237.91 1 237.2 1 236.12 1 225.44 1 212.97 1 200.5 1 188.03 1 175.56 1 163.09 1 150.63 1 138.16 1 125.69 1 113.22 1 100.75 1 88.28 1 75.81 1 63.34 1 56.46 1.26 54.48 14.54 58.01 23.39 54.25 13.03 51.85 1 47.63 1 43.49 1 41.97 1 38.41 1 25.94 1 13.47 1 1 13.47 1 25.94 1 38.41 1 50.88 1 63.34 1 75.81 1 88.28 1 100.75 1 113.22 1 125.69 1 138.16 1 150.63 1 163.09 1 175.56 1 188.03 1 200.5 1 212.97 1 225.44 1 237.91 1 250.38 1 262.84 1 275.31 1 287.78 1 300.25 1 312.72 1 325.19 1 337.66 1 350.13 1 362.59 1 375.06 1 387.53 1 400 1 412.47 1 424.94 1 437.41 1 449.88 1 462.34 1 474.81 1 487.28 1 499.75 1 512.22 1 524.69 1 537.16 1 549.63 1 562.09 1 574.56 1 587.03 1 599.5 1 611.97 1 624.44 1 636.91 1 649.38 1 661.84 1 674.31 1 686.78 1 699.25 1 711.72 1 724.19 1 736.66 1 749.13 1 761.59 1 774.06 1 786.53 1 799 1 799 13.47 799 25.94 799 38.41 799 41.97 Z M 721.61 33 704.82 32.15 708.02 35.11 721.61 33 Z M 440.46 23.83 424.88 25.67 437.95 30.24 440.46 23.83 Z M 621.53 25.65 612.67 20.39 602.12 22.41 621.53 25.65 Z M 339.93 15.36 273.19 18.31 237.83 26.64 248.15 31.9 270.14 33.1 278.71 39.6 281.51 46.92 287.24 45.49 280.37 51.56 285.55 59.46 293.02 65.6 303.84 67.28 305.08 61.55 311.75 55.4 324.19 52.69 329.56 49.5 338.49 48.72 350.46 45.05 347.76 38 357.06 35.81 356.32 25.93 372.94 20.3 348.64 20.61 339.93 15.36 Z M 527.54 43.74 522.85 40.08 529.62 35.78 551.13 31.52 551.08 29.95 523.32 34.07 514.06 40.87 527.54 43.74 Z M 367.84 53.19 346.08 55.06 358.65 59.75 369.83 56.14 367.84 53.19 Z M 199.29 46.45 188.95 41.08 186.16 45.13 190.11 49.63 168.72 49.73 164.7 47.99 148.41 50.46 147.53 48.88 115.96 44.26 97.42 47.78 62.47 44 52.91 42.32 30.34 48.97 41.61 53.94 27.36 54.93 34.34 57.64 43.61 56.89 43.62 59.15 35.22 60.53 31.76 64.17 36.87 67.95 50.38 72.89 44.08 76.35 48.81 76.38 60.21 70.02 71.89 67.55 73.9 65.54 89.96 68.52 97.14 71.46 102.79 71.66 117.52 87.83 127.41 91.88 128.81 95.52 123.88 93.26 125.36 99.59 123.95 105.7 125.74 114.16 133.18 124.14 139.99 127.25 143.93 134.98 146.94 137.18 146.27 140.34 151.07 142.84 151.33 145.66 157.48 148.71 152.58 141.4 145.81 133.64 145.58 130.01 149.19 131.4 151.23 136.32 157.74 141.89 164.97 150.02 165.63 155.2 170.57 159.95 185.96 165.8 190.1 164.59 197.77 169.63 205.67 171.88 210 175.92 209.82 178.03 216.09 182.27 222.66 183.77 224.62 180.56 228.26 185.67 229.03 191.97 225.2 197.44 222.47 198.8 220.52 205.48 223.18 206.39 219.54 211 219.9 214.1 223.2 216.45 231.51 232.97 244.01 241.17 244.63 247.92 242.83 261.77 241.53 264.48 241.64 272.36 237.81 282.79 235.23 296.32 238.81 294.45 237.65 299.04 235.19 298.26 232.32 303.9 235.69 304.55 232.4 308.39 233.87 316.35 242.6 319.83 248.93 316.54 246.74 312.96 254.5 305.21 250.2 303.14 259.33 294.85 255.66 291.53 262.24 290.67 261.82 286.57 268.7 286.33 274.12 282.3 270.34 276.82 278.23 277.98 291.63 264.06 292.5 257.86 296.99 253.9 306.93 251.42 311.86 243.94 313.81 235.23 313.65 231.08 322.13 220.44 321.89 212.61 317.49 211.19 311.38 206.87 303.76 205.78 292.22 201.02 288.31 200.67 289.28 198.18 286.25 191.18 282.78 188.51 273.32 187.26 268.99 182.77 261.71 178.45 262.83 176.75 248.84 177.1 247.31 175.13 241.73 176.19 240.95 172.93 232.69 176.96 229.68 181.35 223.61 179.19 219.48 181.02 214.12 175.29 215.69 167.26 212.98 165.4 202.87 165.28 204.15 163.86 207.04 152.75 199.88 153.95 198.79 157.75 190.69 160.28 187.42 158.76 183.05 150.75 184.67 143.16 184.16 139.81 190.1 135.15 201.81 135.86 201.38 133.61 214.44 134.14 220.07 144.64 222.54 140.92 219.36 132.38 225.87 125.44 232.14 121.7 232.15 116.41 238.46 109.13 244.91 108.2 244.58 103.67 253.34 101.94 255.11 103.97 267.44 98.71 257.09 98 252.48 91.59 242.39 96.71 252.82 89.16 266.93 89.13 276.57 84.91 272.91 79.41 263.01 75.61 263.9 74.22 256.84 66.76 250.04 71.46 245.74 65.15 236.32 62.08 226.86 62.36 228.57 67.83 225.95 70.15 230.33 75.18 223.04 79.32 225.77 83.99 222.86 86.99 219.56 84.88 217.63 78.25 211.56 77.91 198.51 73.52 190.12 69.83 193.5 63.01 206.43 56.91 209.88 52.96 219.59 51.74 219.83 47.19 210.43 45.59 206.37 51.54 199.29 46.45 Z M 208.12 38.33 200.05 40.38 203.42 44.42 219.77 45.9 224.98 44.96 238.96 51.35 236.06 55.41 227.33 55.73 239.88 59.97 253.33 63.22 247.53 59.2 255.89 61.57 252.1 53.34 258.31 56.42 262.89 52.29 247.48 48.17 251.55 47.14 227.49 39.24 221.01 40.76 217.53 37.02 208.12 38.33 Z M 211.23 54.96 210.42 60.73 215.78 58.41 222.44 59.24 211.23 54.96 Z M 177.54 36.81 172.79 39.77 185.6 41.65 177.54 36.81 Z M 132.98 42.23 143.95 37.63 123.1 35.82 120.86 41.19 132.98 42.23 Z M 146.93 38.41 135.33 41.88 148.82 48.58 172.95 48.1 176.16 45.28 168.44 43.13 166.36 39.41 146.93 38.41 Z M 160.13 31.59 144.19 30.97 139.08 33.76 164.34 34.24 160.13 31.59 Z M 190.12 29.6 195.13 34.61 218.35 35.49 220.17 32.67 202.3 32.9 190.12 29.6 Z M 248.16 16.28 196.98 18.97 211.37 24.62 201.63 30.99 221.42 31.64 242.22 23.61 262.8 17.93 248.16 16.28 Z M 207.11 23.92 190 20.49 194.12 26.84 207.11 23.92 Z M 393.34 70.53 388.89 70.54 386.37 74.63 391.95 79.44 390.45 86.98 387.2 89.31 401.22 87.97 401.04 83.17 395.38 76.57 393.34 70.53 Z M 275.57 88.14 274.23 86.81 268.63 94.98 283.3 95.13 281.46 91.33 275.57 88.14 Z M 384.95 84.66 387.45 79.57 383.22 78.29 378.52 81.06 377.88 85.63 384.95 84.66 Z M 223.38 150.04 217.64 149.1 218.63 151.31 225.5 152.62 229.13 155.25 235.57 155.54 223.38 150.04 Z M 239.12 156.45 241.05 160.5 248.56 159.24 243.05 156.43 239.12 156.45 Z M 718.23 231.01 715.91 224.15 714.07 228 714.11 233.85 712.27 239 708.69 239.01 700.2 233.12 703.58 227.88 693.39 225.17 693.88 227.35 689.54 228.29 684.53 233.46 681.66 231.13 678.6 232.04 672.68 236.86 667.9 244.13 653.03 248.73 651.36 254.55 653.08 262.83 656.69 271.89 654.98 276.3 661.62 278.23 665.76 275.81 674.11 275.62 679.63 271.91 691.11 270.32 697.64 272.8 701.44 277.84 705.48 273.43 703.31 278.66 709.39 280.61 711.75 284.78 724.34 287.03 732.49 283.46 736.29 273.74 738.91 270.64 740.41 262.81 738.83 256.51 731.79 250.03 729.95 245.7 724.49 242.52 722.25 233.72 718.23 231.01 Z M 770.45 249.62 763.6 245.07 766.8 248.56 770.45 249.62 Z M 787.06 280.65 785.31 288.08 790.16 292.03 795.71 284.06 788.66 282.98 787.06 280.65 Z M 783.53 291.2 770.29 300.5 769.47 302.95 775.35 303.89 786.25 293.09 783.53 291.2 Z M 722.3 290.92 723.74 297.04 727.88 296.29 728.71 291.11 722.3 290.92 Z M 510.96 230.55 509.05 227.19 505.75 232.85 498.52 236.45 498.36 244.99 495.88 249.39 497.62 255.89 500.66 257.25 504.4 255.79 507.62 245.93 511.89 234.25 510.96 230.55 Z M 697.35 203.05 693.44 201.32 689.32 202.58 696.29 208.34 705.74 212.46 707.38 216.73 705.05 219.15 710.65 218.89 716.16 221.17 720.85 217.41 723.74 218.38 727.87 222.96 734.28 223.32 729.69 220.68 720.49 209.06 706.63 204.27 700.26 207.97 697.35 203.05 Z M 736.9 212.64 728.96 212.55 733.03 214.5 736.9 212.64 Z M 675.83 222.98 681.45 219.71 674.82 221.09 675.83 222.98 Z M 661.35 218.45 658.77 220.52 664.06 219.8 661.35 218.45 Z M 640.78 215.52 635.08 213.57 633.56 215.69 640.02 217.72 653.95 219.9 656.48 219.06 645.52 214.83 640.78 215.52 Z M 634.56 213.47 635.21 207.29 632.5 205.69 630.18 200.27 625.34 195.88 623.09 195.85 616.09 188.87 611.43 189.48 618.57 196.46 627.4 209.85 632.11 213.52 634.56 213.47 Z M 661.29 196.45 660.04 193.33 664.19 188.51 659.64 185.14 646.42 196.4 643.09 196.05 641.82 201.52 644.33 207 651.05 207.41 657.46 209.39 658.37 203.8 660.51 202.28 661.29 196.45 Z M 677.62 197.35 675.04 198.47 667.96 197.6 666.08 199.24 663.27 206.71 664.6 212.43 666.95 212.75 666.68 207 670.96 212.21 673.01 212.34 666.41 199.97 675.84 199.55 677.62 197.35 Z M 685.26 197.99 683.58 195.68 683.06 201.09 685.26 197.99 Z M 680.14 181.85 679.79 179.92 671.13 182.69 674 183.14 677.96 188.13 680.14 181.85 Z M 670.18 174.14 670.44 177.36 672.92 174.82 670.18 174.14 Z M 678.2 173.54 675.46 172.66 676.64 178.03 678.2 173.54 Z M 674.83 177.72 672.53 176.38 672.64 180.5 674.83 177.72 Z M 668.93 159.48 667.59 159.48 666.16 167.31 669.83 168.74 671.58 162.61 668.93 159.48 Z M 644.59 159.1 645.58 155.99 641.88 156.56 640.85 159.47 644.59 159.1 Z M 247.86 317.18 242.38 320.36 234.5 317.62 242.6 322.54 248.94 323.77 255.81 321.75 247.86 317.18 Z M 126.22 92.97 121.24 89.01 115.47 87.96 121.46 92.27 126.22 92.97 Z M 248.27 357.79 244.27 353.18 235.55 360.91 247.53 360.48 248.27 357.79 Z M 299.91 373.5 292.14 373.5 288.1 380.11 303.94 377.89 299.91 373.5 Z M 668.61 149.98 670.33 145.09 666.24 148.28 668.61 149.98 Z M 712.5 118.17 714.51 113.65 713.37 108.78 711.01 109.18 709.06 115.79 700.75 121.75 693.97 121.96 686.86 126.69 691.12 130.79 692.6 127.02 690.35 125.39 699.43 123.81 701.01 126.32 704.17 123.79 710.89 122.61 712.5 118.17 Z M 698.45 124.8 694.65 125 694.85 128 698.45 124.8 Z M 719 102.58 714.69 99.53 713.91 105.9 717.39 107.41 722.62 104.6 719 102.58 Z M 718.42 88.01 716.11 81.33 714.97 98.61 718.17 96.68 718.42 88.01 Z M 580.03 186.76 581.3 183.82 577.66 178.72 576.66 182.32 578.11 187.27 580.03 186.76 Z M 434.4 115.75 427.56 117.12 433.47 119.33 434.4 115.75 Z M 420.42 109.15 418.68 113.67 421.43 113.66 420.42 109.15 Z"
          stroke="#DAA520"
          stroke-width="1"
          fill="#444444"
          fill-rule="evenodd"
        />
      </g>

      <path d={@toppath} stroke="#DAA520"
          stroke-width="1" />

      <path d={@btmpath} stroke="#DAA520"
          stroke-width="1" />

      <%= for {x, y} <- coords(@regions) do %>
        <circle cx={x} cy={y} r="4" fill="#e6bc2f" opacity="0.9" />
      <% end %>

      <%= for {x, y} <- coords(@our_regions) do %>
        <circle cx={x} cy={y} r="8" fill="#facc15" opacity="0.9" />
      <% end %>

    </svg>
    """
  end

  @doc """
  Get coordinates for active regions to display on the map
  """
  def coords(regions) do
    # Convert region codes to coordinates for the map
    regions
    |> Enum.map(fn region -> city_to_svg(region, @bbox) end)
  end


  def city_to_svg("unknown", _bbox) do
    {-1, -1}
  end

  def city_to_svg(city, bbox) when city != "unknown" do
      city_atom = String.to_existing_atom(city) # |> IO.inspect()
      {long, lat} = cities()[city_atom] # |> IO.inspect(label: "{long, lat} for #{city}")
      # latlong_to_svg({long, lat}, bbox)
      point = wgs84_to_svg({long, lat}, bbox) #|> IO.inspect(label: "transformed to point")
      point
  end

  @doc """
    Transforms WGS84 (EPSG:4326) lat/long coordinates to SVG x/y positions.

    Parameters:
    - lat: Latitude in degrees
    - long: Longitude in degrees
    - svg_width: Width of the SVG in pixels
    - svg_height: Height of the SVG in pixels
    - bounds: Map with geographic bounds in format:
              %{min_long: value, max_long: value, min_lat: value, max_lat: value}

    Returns {x, y} coordinates in the SVG space
    """
    def wgs84_to_svg({long, lat}, {x_min, y_min, x_max, y_max}) do
      svg_width = x_max - x_min
      svg_height = y_max - y_min

      bounds=%{min_long: -180, max_long: 180, min_lat: -90, max_lat: 90}

      # Calculate percentage position along each axis
      x_percent = (long - bounds.min_long) / (bounds.max_long - bounds.min_long)

      # Note the inversion for y-axis since SVG's y increases downward
      # while latitude increases upward
      y_percent = 1 - (lat - bounds.min_lat) / (bounds.max_lat - bounds.min_lat)

      # Convert to pixel positions
      x = x_percent * svg_width
      y = y_percent * svg_height

      {x, y}
    end

    # def latlong_to_svg({long, lat}, {x_min, y_min, x_max, y_max}) do
    #   svg_width = x_max - x_min
    #   svg_height = y_max - y_min

    #    # Standard Mercator projection
    #    x = (long + 180) * (svg_width / 360)

    #    # Convert latitude to y coordinate using Mercator formula
    #    lat_rad = lat * :math.pi() / 180
    #    merc_n = :math.log(:math.tan((:math.pi() / 4) + (lat_rad / 2)))
    #    y = svg_height / 2 - (svg_width * merc_n / (2 * :math.pi()))

    #    {x, y}

    #   end


  # <!-- Machine indicators based on regions -->
  #   <circle cx="200" cy="200" r="10" fill="#e6bc2f" opacity="0.9">
  #     <title>YYZ - Toronto</title>
  #     <animate attributeName="r" values="10;12;10" dur="3s" repeatCount="indefinite" />
  #   </circle>

  #   <circle cx="150" cy="240" r="10" fill="#e6bc2f" opacity="0.9">
  #     <title>LAX - Los Angeles</title>
  #     <animate attributeName="r" values="10;12;10" dur="3s" repeatCount="indefinite" />
  #   </circle>

  #   <circle cx="500" cy="190" r="10" fill="#e6bc2f" opacity="0.9">
  #     <title>AMS - Amsterdam</title>
  #     <animate attributeName="r" values="10;12;10" dur="3s" repeatCount="indefinite" />
  #   </circle>

  #   <circle cx="800" cy="320" r="10" fill="#e6bc2f" opacity="0.9">
  #     <title>SYD - Sydney</title>
  #     <animate attributeName="r" values="10;12;10" dur="3s" repeatCount="indefinite" />
  #   </circle>
  # fill="url(#platinumFill)"
#
end
